source: slave
target: itsql

defaults:
  object: '{ENV_SCHEMA}_dl.outbound_aop_{stream_table}_intelix'
  source_options:
    limit: 2000
  mode: incremental
  primary_key: [id]
  update_key: created_time

env:
  SLING_LOADED_AT_COLUMN: timestamp

streams:
  dyn_outbound_aop.tms_prospect:
    update_key: modified_time
    sql: |
      SELECT
        *
        ,COALESCE(last_info_time, created_time) AS modified_time
      FROM {stream_schema}.{stream_table}
      WHERE COALESCE(last_info_time, created_time) > COALESCE(ADDTIME({incremental_value}, '-00:00:05'), '2020-12-01')
      ORDER BY COALESCE(last_info_time, created_time)
    meta:
      dagster:
        asset_key: 'outbound_aop_tms_prospect_intelix'
        deps: 'outbound_aop_tms_prospect'
        group: 'outbound_aop'